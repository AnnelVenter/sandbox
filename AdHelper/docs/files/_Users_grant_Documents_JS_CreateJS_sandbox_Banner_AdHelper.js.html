<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>/Users/grant/Documents/JS/CreateJS_sandbox/Banner/AdHelper.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/AdHelper.html">AdHelper</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: /Users/grant/Documents/JS/CreateJS_sandbox/Banner/AdHelper.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/*
 * AdHelper
 * Visit http://createjs.com/ for documentation, updates and examples.
 *
 *
 * Copyright (c) 2015 gskinner.com, inc.
 *
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the &quot;Software&quot;), to deal in the Software without
 * restriction, including without limitation the rights to use,
 * copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following
 * conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 * OTHER DEALINGS IN THE SOFTWARE.
 */

// namespace:
this.createjs = this.createjs || {};

(function(){
&quot;use strict&quot;;
	
// constructor
	/**
	 * Class that provides a number of helpful capabilities for online advertisements such as:&lt;ol&gt;
	 * &lt;li&gt; sleep/pause and mute the ad while it&#x27;s in a background tab
	 * &lt;li&gt; sleep/pause after a delay &amp; wake on interaction
	 * &lt;li&gt; display alternate content if the browser isn&#x27;t supported
	 * &lt;li&gt; watch framerate and display alternate content if slow
	 * &lt;li&gt; time-synch playback to maintain duration even when framerate is slow
	 * &lt;li&gt; ensure full resolution graphics on high DPI screens
	 * &lt;/ol&gt;
	 * These features work together. For example, sleep time will be deferred and performance
	 * measurements will be halted when an ad is paused due to being in a background tab.
	 * 
	 * Background tab detection is enabled automatically, and works in all browsers that support the page visibility API. This includes all
	 * modern browsers except IE &lt;10, Opera Mini, and the Android Browser &lt;4.4. Note that audio is currently muted, not
	 * paused, which can cause audio to become desynched. Use the &quot;sleep&quot; and &quot;wake&quot; events to pause/resume your audio
	 * if this is a problem.
	 * 
	 * Most methods can be chained to allow single line initialization. For example, this would
	 * create an ad helper that sleeps after 15s, and has alt content:
	 * 
	 * Background tab detection works in all browsers that support the page visibility API. This includes all
	 * modern browsers except IE &lt;10, Opera Mini, and the Android Browser &lt;4.4.
	 * 
	 * 	var ad = new AdHelper(myStage).setSleep(15).setAlt(&quot;http://createjs.com/&quot;,&quot;altImage.jpg&quot;);
	 * 
	 * NOTE: This class is specifically designed to work in an advertising environment, where the ad
	 * is isolated to its own iframe. It can cause problems if there are multiple CreateJS
	 * experiences in the same document.
	 * @class AdHelper
	 * @param {Stage} stage The target Stage object.
	 * @extends EventDispatcher
	 */
	function AdHelper(stage) {
		this._stage = stage; // up here because its used by pixelRatio.
		
	// public properties:
		/**
		 * This listener will be removed from the Ticker when the ad sleeps, and added back when it wakes.
		 * By default this will be the stage, to stop updates when sleeping, however if you define your own tick
		 * handler that subsequently calls &#x60;stage.update&#x60; you should specify it instead.
		 * 
		 * NOTE: if using &#x60;on&#x60; to add your tick listener, make sure to use the generated listener object as
		 * the sleepListener. Example:
		 * 
		 * 	var listener = createjs.Ticker.on(&quot;tick&quot;, myTickFunction, scope);
		 * 	myAdHelper.setSleep(15, 3, 0, listener);
		 * 
		 * @property sleepListener
		 * @type {Function|Object}
		 */
		this.sleepListener = null;
		
		/**
		 * True when awake, false when sleeping.
		 * @property awake
		 * @type {Boolean}
		 * @readonly
		 */
		this.awake = true;
		
		/**
		 * Disables sleep if false. Enabled automatically when calling &#x60;setSleep()&#x60;.
		 * @property sleepEnabled
		 * @type {Boolean}
		 * @default false
		 */
		this.sleepEnabled = false;
		
		/**
		 * True when the ad is hidden (ex. in a background tab).
		 * @property hidden
		 * @type {Boolean}
		 * @readonly
		 */
		this.hidden = false;
		
		/**
		 * Returns the pixel ratio that is being used to draw the canvas on a high dpi device. On browsers that
		 * automatically utilize high dpi backing stores (like Safari), this returns the backingStorePixelRatio. For
		 * other browsers, this returns 1 by default.
		 * 
		 * If you call the &#x60;fixDPI()&#x60; method, then &#x60;pixelRatio&#x60; will be set to the resulting scale.
		 * 
		 * This value is primarily useful for loading appropriately sized bitmap images.
		 * 
		 * 	myAdHelper.fixDPI();
		 * 	if (myAdHelper.pixelRatio &gt; 1.5) {
		 * 		// load high res images.
		 * 	} else {
		 * 		// load low res images.
		 * 	}
		 * @property pixelRatio
		 * @type {Number}
		 * @readonly
		 */
		this.pixelRatio = this._getBackingRatio();
		
	// private properties:
		this._time = 0;
		
		this._awake = true; // whether the ad should be awake ignoring tab visibility
		this._sleepy = false; // indicates it should sleep on the next tick
		this._sleepT = 0; // time to go to sleep
		this._sleepMousedownT = null; // time before sleep if user clicks on the stage
		this._sleepInBoundsT = null; // time before sleep if the mouse is in bounds
		this._sleepUseTicks = false; // must be set in props if using startDelay
		this._mouseInDoc = false; // iframes can break stage.mouseInBounds
		
		this._altHTML = &quot;error&quot;;
		
		this._perfDelay = 0; // wait a few ticks before measuring performance
		this._perfCount = 0;
		this._perfThreshold = 0;
		this._perfFPS = 0;
		this._perfUseAlt = false;
		
		this._width = stage.canvas.width; // for use with highDPI in case of multiple calls.
		this._height = stage.canvas.height;
		
		createjs.Ticker.on(&quot;tick&quot;, this);
	}
	var p = createjs.extend(AdHelper, createjs.EventDispatcher);
	
	
// events:
	/**
	 * Dispatched when the ad wakes, either via the &#x60;wake()&#x60; method or automatically due to user interaction or
	 * the browser tab coming to the foreground.
	 * @event wake
	 */
	 
	/**
	 * Dispatched when the ad sleeps, either via the &#x60;sleep()&#x60; method or automatically due to sleep scheduling or
	 * the browser tab being hidden.
	 * @event sleep
	 */
	 
	/**
	 * Dispatched if performance monitoring (via watchFPS) detects that the ad is running slowly.
	 * @event slow
	 */

// public methods
	/**
	 * Specifies alternative content to display if the browser is not supported. You can set a link href/url, an image,
	 * and text. If an image is specified, the text is used as its alt text. If you require more control over the content
	 * use &#x60;setAltHTML&#x60; instead.
	 * 
	 * When the alt content is displayed, the banner is put to sleep, and the stage&#x27;s target canvas is replaced with a
	 * div element containing the alt content and with an id of &quot;adAlt&quot;, which you can use for styling or JS.
	 * @method setAlt
	 * @param {String} href The URL to link.
	 * @param {String} imgSrc An image to display. You can omit this, and just show text by passing in &#x60;null&#x60;.
	 * @param {String} [text] Text to use as alt text if &#x60;imgSrc&#x60; is specified, or to display as a link if not.
	 * @param {String} [target=&quot;_blank&quot;] The link target to use (ex. _blank, _parent). Default is _blank.
	 * @return {AdHelper} The AdHelper instance the method is called on (useful for chaining calls.)
	 * @chainable
	 */
	p.setAlt = function(href, imgSrc, text, target) {
		this.setAltHTML(
			(href?&quot;&lt;a target=&#x27;&quot;+(target||&quot;_blank&quot;)+&quot;&#x27; href=&#x27;&quot;+href+&quot;&#x27;&gt;&quot;:&quot;&quot;)+ 
			(imgSrc?&quot;&lt;img src=&#x27;&quot;+imgSrc+&quot;&#x27; border=&#x27;0&#x27; alt=&#x27;&quot;+(text||&quot;&quot;)+&quot;&#x27;&gt;&quot;:&quot;&quot;)+
			(text&amp;&amp;!imgSrc?text:&quot;&quot;)+
			(href?&quot;&lt;/a&gt;&quot;:&quot;&quot;));
		return this;
	};
	
	/**
	 * Specifies alternative HTML content to display if the browser is not supported.
	 * 
	 * When the alt content is displayed, the banner is put to sleep, and the stage&#x27;s target canvas is replaced with a
	 * div element containing the alt content and with an id of &quot;adAlt&quot;, which you can use for styling or JS.
	 * @method setAltHTML
	 * @param {String} html The HTML content to display.
	 * @return {AdHelper} The AdHelper instance the method is called on (useful for chaining calls.)
	 * @chainable
	 */
	p.setAltHTML = function(html) { // TODO: also accept a HTMLElement
		this._altHTML = html;
		if (!window.CanvasRenderingContext2D) { this.showAlt(); }
		return this;
	};
	
	/**
	 * Shows the alternate content that was specified with &#x60;setAlt&#x60; or &#x60;setAltHTML&#x60;.
	 * @method showAlt
	 */
	p.showAlt = function() {
		var canvas = stage.canvas;
		var div = document.createElement(&quot;div&quot;);
		div.innerHTML = this._altHTML || &quot;&quot;;
		div.id = &quot;adAlt&quot;;
		canvas.parentNode.replaceChild(div, canvas);
		this.sleep();
		this.sleepEnabled = false;
	};
	
	/**
	 * Causes all MovieClip instances to run in time synched mode, so their duration remains consistent regardless of
	 * real framerate (ex. if framerate drops due to performance issues).
	 * 
	 * NOTE: If a framerate value is not specified, it will use &#x60;lib.properties.fps&#x60; if available, and finally fall back to &#x60;Ticker.getFPS()&#x60;.
	 * If the latter occurs, and the &#x60;Ticker&#x60; framerate has not been correctly set yet, you may see unexpected playback speed.
	 * 
	 * This feature works by injecting code into EaselJS that causes all MovieClip instances to use a master frame rate as
	 * their &#x60;framerate&#x60; property value. See &#x60;MovieClip.framerate&#x60; for information.
	 * @method timeSync
	 * @param {Boolean} [framerate] The target framerate. Usually the framerate your ad was authored at.
	 * @return {AdHelper} The AdHelper instance the method is called on (useful for chaining calls.)
	 * @chainable
	 */
	p.timeSync = function(framerate) {
		var futureVersion = (this._stage.masterFrameRate !== undefined); // TODO: name?
		this._stage.masterFrameRate = this._getTickerFPS();
		
		// try to be forwards compatible:
		if (futureVersion) { return this; }
		
		var stage_p = createjs.Stage.prototype, mc_p = createjs.MovieClip.prototype;
		stage_p.__tick = stage_p._tick;
		stage_p._tick = function(evt) {
			evt.stage = this;
			this.__tick(evt);
		}
		
		mc_p.__tick = mc_p._tick;
		mc_p._tick = function(evt) {
			if (!this.ignoreMasterFrameRate &amp;&amp; evt.stage) {
				this.framerate = evt.stage.masterFrameRate || null;
			}
			this.__tick(evt);
		}
		return this;
	};
	
	
	/**
	 * Watches the measured framerate for the ad, and applies a simple heuristic to determine when the ad has been
	 * running too slowly for too long. When this happens a &#x60;slow&#x60; event is dispatched, and if &#x60;useAlt&#x60; is true, then
	 * &#x60;showAlt()&#x60; is called.
	 * @method watchFPS
	 * @param {Boolean} [showAlt] If true, then when the ad is detected to be slow, &#x60;showAlt&#x60; is called.
	 * @param {Number} [showAlt] The minimum framerate considered acceptable. Calculated automatically if null.
	 * @param {Number} [tolerance=1] The tolerance of the system. A higher value (ex 2) allows more slow frames before acting than a lower number (ex. 0.5). Default is 1.
	 * @return {AdHelper} The AdHelper instance the method is called on (useful for chaining calls.)
	 * @chainable
	 */
	p.watchFPS = function(showAlt, minFPS, tolerance) {
		this._perfUseAlt = showAlt;
		this._perfFPS = minFPS || (this._getTickerFPS()*0.9-1|0);
		this._perfThreshold = tolerance || 1;
		this._perfCount = 0;
		this._perfDelay = 5;
		return this;
	};
	
	
	/**
	 * Upscales the canvas as appropriate to display full resolution graphics on high dpi devices and updates the
	 * &#x60;pixelRatio&#x60; property accordingly.
	 * 
	 * If &#x60;false&#x60; is passed to the &#x60;enabled&#x60; parameter, then high DPI rendering will be disabled, including downscaling
	 * the canvas on devices that automatically render at high DPI. This can be useful for reducing render cost on slower
	 * devices.
	 * 
	 * It will change the canvas width/height attributes, the canvas&#x27;s CSS width/height, and the stage&#x27;s scaleX/Y as
	 * necessary.
	 * @method highDPI
	 * @param {Boolean} [enabled=true] If false, disables high DPI rendering.
	 * @return {AdHelper} The AdHelper instance the method is called on (useful for chaining calls.)
	 * @chainable
	 */
	p.highDPI = function(scale, enabled) {
		var backingRatio = this._getBackingRatio();
		var scale = Math.max(1, (window.devicePixelRatio || 1) / backingRatio);
		var stage = this._stage, canvas = stage.canvas, style = canvas.style;
		var w = this._width, h = this._height;
		
		// downscale if highDPI is explicitly disabled:
		if (enabled === false) {
			scale = 1/backingRatio;
		}
		
		canvas.width = w * scale;
		canvas.height = h * scale;
		style.width = w+&quot;px&quot;;
		style.height = h+&quot;px&quot;;
		stage.scaleX = stage.scaleY = scale;
		
		this.pixelRatio = backingRatio === 1 ? scale : enabled === false ? 1 : backingRatio;
		return this;
	};
	
	
	/**
	 * Sets the sleep schedule for the ad. The system will always use the latest sleep time. For example, if you called:
	 * &#x60;setSleep(15, 3)&#x60; and the user clicked the ad after 4 seconds, the ad would still sleep after 15 seconds (15 &gt; 3+4).
	 * @method setSleep
	 * @param {Number} start The delay in seconds after this call to wait before sleeping. Set to null to ignore this behaviour.
	 * @param {Number} [mousedown=null] The delay after the user clicks the banner to wait before sleeping. Set to null to ignore this behaviour.
	 * @param {Number} [inBounds=null] The delay after the user&#x27;s mouse leaves the banner to wait before sleeping. Set to null to ignore this behaviour. For example, set to 0 to wake when the mouse enters, and sleep immediately when it leaves.
	 * @param {Boolean} [useTicks=false] If true, the sleep times are specified in ticks instead of in seconds.
	 * @param {Function|Object} [listener] Defaults to stage. The listener to add/remove from Ticker when waking/sleeping. See &#x60;tickListener&#x60; for more details.
	 * @return {AdHelper} The AdHelper instance the method is called on (useful for chaining calls.)
	 * @chainable
	 */
	p.setSleep = function(start, mousedown, inBounds, useTicks, listener) {
		if (mousedown != null) { stage.addEventListener(&quot;stagemousedown&quot;, this); }
		if (inBounds != null) {
			document.addEventListener(&quot;mouseout&quot;, this, true);
			document.addEventListener(&quot;mousemove&quot;, this, true);
		}
		this.sleepListener = listener || this._stage;
		this._sleepMousedownT = mousedown;
		this._sleepInBoundsT = inBounds;
		this._sleepUseTicks = !!useTicks;
		this.sleepEnabled = true;
		
		this._sleepy = false; // indicates it should sleep on the next tick
		this._sleepT = (start != null) ? this._getTime() + start*1000 : 0;
		return this;
	};
	
	/**
	 * Sleeps the ad after the specified delay. This pauses the ticker, unsubscribes the &#x60;sleepListener&#x60;,
	 * and pauses GreenSock TweenLite/TweenMax tweens.
	 * @method sleep
	 * @param {Number} [delay=0] The delay before sleeping, or 0 to sleep immediately.
	 */
	p.sleep = function(delay) {
		if (delay) { this._sleepT = this._getTime()+(delay||0); return; }
		this._sleepy = false;
		this._sleepT = 0;
		this._awake = false;
		this._sleep();
	};
	
	/**
	 * Wakes the ad for a specified amount of time.
	 * @method wake
	 * @param {Number} [time=null] The amount of time to wake for, or null to wake permanently.
	 */
	p.wake = function(time) {
		this._sleepy = false;
		if (time != null) { this._sleepT = Math.max(this._sleepT, this._getTime()+(time||0)); }
		else { this._sleepT = 0; }
		this._awake = true;
		this._wake();
	};
	
	p.handleEvent = function(evt) {
		if (evt.type === &quot;tick&quot;) {
			this._tick(evt);
		} else if (evt.type === &quot;stagemousedown&quot;) {
			var d = this._sleepMousedownT;
			if (this.sleepEnabled &amp;&amp; d != null) { this.wake(d*1000); }
		} else if (evt.type === &quot;mousemove&quot;) {
			this._mouseInDoc = true;
		} else if (evt.type === &quot;mouseout&quot;) {
			this._mouseInDoc = false;
		}
	};

	
// private methods:
	p._getTickerFPS = function() {
		return (createjs.Ticker.timingMode == createjs.Ticker.RAF ? 60 : createjs.Ticker.framerate);
	};
	
	p._sleep = function() {
		if (!this.awake) { return; }
		createjs.Ticker.paused = true;
		if (this.sleepListener) { createjs.Ticker.removeEventListener(&quot;tick&quot;, this.sleepListener); }
		window.TweenLite &amp;&amp; TweenLite.ticker &amp;&amp; TweenLite.ticker.sleep();
		this.dispatchEvent(&quot;sleep&quot;);
		this.awake = false;
	};
	
	p._wake = function() {
		if (this.awake) { return; }
		createjs.Ticker.paused = false;
		if (this.sleepListener) { createjs.Ticker.addEventListener(&quot;tick&quot;, this.sleepListener); }
		window.TweenLite &amp;&amp; TweenLite.ticker &amp;&amp; TweenLite.ticker.wake();
		this.dispatchEvent(&quot;wake&quot;);
		this.awake = true;
	};

	p._tick = function(evt) {
		/* tab visibility */
		if (document.hidden || document.webkitHidden || document.mozHidden) {
			this.hidden = true;
			this._sleep();
			if (createjs.Sound) { createjs.Sound.muted = true; }
			return;
		} else if (this.hidden) {
			this.hidden = false;
			if (this._awake) { this._wake(); }
			this._perfDelay = 3;
			if (createjs.Sound) { createjs.Sound.muted = false; }
		}
		this._time += this._sleepUseTicks ? 1 : evt.delta;
		
		/* perf */
		var fps;
		if (this._perfFPS &amp;&amp; (--this._perfDelay &lt;= 0) &amp;&amp; (fps = createjs.Ticker.getMeasuredFPS(1)) &gt; -1) {
			var val = 1-Math.max(0, Math.min(1, fps / this._perfFPS));
			this._perfCount = Math.max(0, this._perfCount + (val === 0 ? -0.2 : val*val*0.5+0.1));
			if (this._perfCount &gt; this._perfThreshold) {
				if (this.dispatchEvent(&quot;slow&quot;) &amp;&amp; this._perfUseAlt) { this.showAlt(); }
				this._perfFPS = 0;
			}
		}
		
		/* sleep */
		if (this.sleepEnabled) {
			if (this._sleepInBoundsT != null &amp;&amp; this._stage.mouseInBounds &amp;&amp; this._mouseInDoc) { this.wake(this._sleepInBoundsT*1000); }
			if (this._sleepy) { this.sleep(); }
			else if (this._sleepT &amp;&amp; (this._getTime() &gt;= this._sleepT)) { this._sleepy = true; } // delay 1 tick.
		}
	};
	
	p._getTime = function() {
		return this._time;
	};
	
	p._getBackingRatio = function() {
		var ctx = this._stage.canvas.getContext(&quot;2d&quot;);
		return ctx.backingStorePixelRatio || ctx.webkitBackingStorePixelRatio || ctx.mozBackingStorePixelRatio || ctx.msBackingStorePixelRatio || ctx.oBackingStorePixelRatio || 1;
	};

	createjs.AdHelper = createjs.promote(AdHelper, &quot;EventDispatcher&quot;);
})();
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
